# New UI メモ

## スコープ / 現在の決定事項
- パネルの追加は最小限（サブパネル程度）に留める。
- ルートは維持する。
- 既存のオーバーレイ（DetailLayer / ConsultDetailLayer）は使わない。
  - ただし中身のデザイン（吹き出し表示など）は流用したい。

## 移植対象
- お知らせカード（旧UI）: `apps/web/components/notifications/NotificationsPanel.tsx`
  - Homeの会話/相談パネル内へ分割移植。
  - 内部ロジックは移植するが、見た目は `apps/web/app/ui-demo/page.tsx` を優先して調整する。
- 管理室配下（管理室トップは新UI済み、それ以外を同じ管理室パネル内へ移植）
  - `/office/residents`
  - `/office/residents/[id]`
  - `/office/residents/[id]/edit`
  - `/office/new`
  - `/office/presets`
  - `/office/relations/[id]`
- 情報系（入口のみ、内容は管理室パネル内に表示）
  - `/settings`
  - `/playguide`
  - `/specs`
  - `/legal/privacy`
  - `/contact`

## 移植不要（削除OK）
- `/home/residents`
- `/player`

## Home パネルの挙動
### 状態（排他）
- none: 通常表示
- right-detail: ホームからの会話詳細
- right-peek: 覗くパネル（将来）
- popup-consult: 相談詳細ポップアップ

### スライド
- right-detail:
  - 中央＋右パネルを右に約 520〜600px スライド（画面幅に応じて可変）
  - 左パネルは固定
  - 空いた中央〜右側の領域に会話詳細パネルを表示（伸縮型）
- right-peek:
  - 左＋中央＋右パネルを左に約 520〜600px スライド
  - 右側の空きに覗くパネルを表示
- popup-consult:
  - スライドなし
  - 正面中央にガラス系ポップアップを重ねて表示

### 操作防止
- スライド中や詳細表示中は、必要に応じて透明ブロッカーで背面操作を防ぐ。

## 日報（会話ログ詳細）
- 旧ログ詳細は、日報の DeskPanel 上で右側に重なるサブパネルとして表示。
- 閉じると日報一覧に戻る。

## 相談詳細
- Home から開いた場合: popup-consult（正面中央の一時パネル）
- 日報から開いた場合: 旧ログ詳細と同じ右側サブパネル
- 専用 DeskPanel は作らない。

## 管理室の方針
- 管理室は「大きな1パネル」だけにする。
- 入口カードから内部表示を切り替える（一覧/詳細/編集/新規/プリセット/関係）。
- 情報系も入口カードのみで、内容は管理室パネル内に表示切替。

## 備考
- 将来の「覗く」パネルは会話詳細と似た実装だが、スライド方向は逆。
- お知らせカードは中身を移植しつつ、UIは ui-demo を優先する。


## Home のDOM構成案（ラッパー分割）
- 目的: 右詳細 / 覗く のスライドを成立させるため、パネル群を分割して動かす。
- 分割案:
  - LeftPanelWrap: 左パネルのみ
  - CenterRightWrap: 中央＋右パネル
  - FloatingLayer: 伸縮型の臨時パネルを置く絶対配置レイヤ
  - PopupLayer: 相談詳細のポップアップ用レイヤ
- 状態による挙動:
  - right-detail: CenterRightWrap を右へスライド + FloatingLayer に会話詳細
  - right-peek: LeftPanelWrap + CenterRightWrap を左へスライド + FloatingLayer に覗く
  - popup-consult: PopupLayer に相談詳細（スライドなし）

## Home の詳細パネル位置イメージ
- FloatingLayer（会話詳細 / 覗く）:
  - 位置: パネル群の空き領域に追従
  - 幅: 伸縮型（空き領域フィット、max幅で制御）
  - 表示: ガラス系パネル + 既存オーバーレイの中身デザインを流用
- PopupLayer（相談詳細）:
  - 位置: 正面中央（4枚目の一時パネル）
  - 幅: 既存の相談詳細UIが破綻しない程度に固定〜可変
  - 背面: クリックブロック or 半透明の背面シェード

## お知らせカード移植（ui-demo準拠マッピング）
- 参照元: `apps/web/app/ui-demo/page.tsx`
- 会話パネル:
  - card構造: messageCard / messageRow の2段構成
  - 要素:
    - 左: initial
    - 中: 本文（snippet / fallback title）
    - 右: 時刻 or 「見てみる >」リンク
- 相談パネル:
  - card構造: consultationRow（2列×2行のグリッド）
  - 配置:
    - 左側（縦2行をまたぐ）: 相談メッセージ
      - 1行目: 「{name} から」
      - 2行目: 「　相談が届いています」
    - 右上: 時刻
    - 右下: 「回答する >」リンク
- 共通:
  - ガラス風の背景・枠線・影は ui-demo の表現を優先
  - 内部ロジック（未読/開く動作）は既存 HomeContent のものを流用

## Home DOM構成（具体案）
- ルート構造は `HomeContent` の中で完結させる。
- レイヤー順序（下→上）:
  1) 背景（現状の sky/desk）
  2) パネル群（LeftPanelWrap / CenterRightWrap）
  3) FloatingLayer（会話詳細 / のぞく）
  4) PopupLayer（相談詳細）
- パネル群の分割
  - LeftPanelWrap: 左パネルのみ
  - CenterRightWrap: 中央＋右パネル
- スライド量
  - 目安: 520〜600px
  - 画面幅に応じて `clamp(480px, 30vw, 640px)` 等で可変化
- 空き領域へのパネル配置
  - FloatingLayer は `position: absolute` で空き領域に追従
  - `left/right` をパネル幅計算に合わせて決め、伸縮型で表示
- 操作ブロック
  - 詳細表示中は、透明のクリックブロッカーをパネル群の上に置く

## 日報 右サブパネル（会話ログ詳細）
- `ReportContent` の `DeskPanel` 上に重ねて表示
- 右側からスライドするサブパネルとして配置
- 既存のログ詳細UI（吹き出しレイアウト）を流用
- 閉じると日報一覧のみ表示

## 相談詳細の表示ルール
- Home から: PopupLayer（正面中央のガラスパネル）
- 日報から: 右サブパネル（会話ログ詳細と同じ）
- 既存の相談詳細UI（吹き出しレイアウト）を流用

## 管理室パネル内ビュー切替（構成案）
- 管理室は1パネル内でビューを切替
- 入口カード（トップ）から以下のビューへ遷移:
  - 住人一覧 / 住人詳細 / 住人編集 / 新規登録
  - プリセット管理
  - 関係詳細
  - 情報系（設定 / 遊び方 / 仕様 / プライバシー / 連絡先）
- ルートは維持し、`pathname` に応じて同一パネル内で内容を出し分ける
  - 例: `/office/residents` なら一覧ビュー、`/settings` なら設定ビュー

## 情報系ビューの扱い
- 管理室トップに入口カードとして配置
- クリックで管理室パネル内の該当ビューへ切替
- 新しい独立パネルは作らない

## 相互作用フロー（ホーム）
- 会話通知をクリック
  - right-detail に切替
  - 中央+右パネルを右へスライド
  - 空き領域に会話詳細パネル（伸縮）
- 相談通知をクリック
  - popup-consult に切替
  - 正面中央にポップアップ表示
- 閉じる操作
  - ポップアップはクローズボタンまたは背面クリック
  - right-detail はクローズボタン（または背面クリック）で none に戻る

## 相互作用フロー（日報）
- 一覧のログをクリック
  - 右サブパネルに詳細を表示
- 相談ログをクリック
  - 会話ログと同様に右サブパネルで詳細表示
- 閉じる操作
  - 右サブパネルを閉じて一覧のみに戻る

## レスポンシブ挙動（概要）
- 幅が狭い場合はスライド量を調整
- ポップアップは幅に応じて小さめの幅を優先
- 詳細パネルは空き領域に合わせて伸縮
