# 第7章 データ・同期・永続化
- スキーマ方針: Drizzleでのテーブル/カラム、共通カラム(`id/updated_at/deleted/owner_id`)、RLS前提。
- 主要テーブル: residents/relations/conversations/topics/world_facts/weather/events/achievements/boards/articles 等の必須項目リスト。
- 永続化層: WebはIndexedDB、デスクトップはTauri app.db(JSON/KV)とのマッピング。
- 同期: Supabase(Postgres)とのdiff同期方式、`updated_at`優先、tombstone処理、衝突時の解決ルール。Offline→Online復帰のフロー。
- シード/初期データ: WorldFacts/Topic初期生成、デモ住人/関係、天気初期値の扱い。
- バックアップ/保持: ローカル保存期間、クリア/リセットの方法、ログ/トレースの保存先。
- エラーハンドリング: 同期失敗時の再試行、部分失敗の扱い、ユーザー通知。
