# 第2章 システム構成
- 全体構成: Web(PWA, Next.js App Router) / デスクトップ(Tauri) / サーバー(Supabase Postgres, GPT-API) / クライアントDB(IndexedDB, Tauri app.db)。
- データフロー: 会話生成リクエスト→GPT→保存、WorldFacts→Topic生成、同期(`/app/api/sync/{table}`)の流れ、tombstone(`deleted`, `updated_at`)運用。
- 主要技術: Next.js+TypeScript+Tailwind+shadcn/ui、TanStack Query、Drizzle ORM、Supabase Realtime、next-pwa、Sentry。Rust(Tauri)・Node環境条件。
- 環境変数: `.env` / `.env.local` に必要なキー(NEXT_PUBLIC_SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY, GPTキー等)。
- ビルド/配布: `pnpm dev`/`build`/`tauri:build`、PWAマニフェストとSW、デスクトップの配置先(appData)。
- セキュリティ/RLS: Supabaseのowner_id RLSポリシー、通信経路(HTTPS)、鍵管理の方針。
